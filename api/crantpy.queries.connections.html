
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>crantpy.queries.connections module &#8212; CRANTpy Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/crantpy.queries.connections';</script>
    <link rel="icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="crantpy.queries.neurons module" href="crantpy.queries.neurons.html" />
    <link rel="prev" title="crantpy.queries package" href="crantpy.queries.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">ðŸ“š Tutorials available! Check out the Deep Dive Gallery.</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="CRANTpy Documentation - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="CRANTpy Documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation &amp; Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Quickstart Tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Deep Dive</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/advanced_queries.html">Advanced Neuron Querying</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/visualization.html">Plotting Neurons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/morphology.html">Working with Neuron Morphology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/connectivity.html">Analyzing Connectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/segmentation.html">Using EM Segmentation Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/ngllink.html">From CRANTpy to Neuroglancer</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="modules.html">API Reference</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="crantpy.html">crantpy package</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active has-children"><a class="reference internal" href="crantpy.queries.html">crantpy.queries package</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l4 current active"><a class="current reference internal" href="#">crantpy.queries.connections module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.queries.neurons.html">crantpy.queries.neurons module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="crantpy.utils.html">crantpy.utils package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="crantpy.utils.cave.html">crantpy.utils.cave package</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.utils.config.html">crantpy.utils.config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.utils.decorators.html">crantpy.utils.decorators module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.utils.exceptions.html">crantpy.utils.exceptions module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.utils.helpers.html">crantpy.utils.helpers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.utils.neuroglancer.html">crantpy.utils.neuroglancer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.utils.seatable.html">crantpy.utils.seatable module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.utils.types.html">crantpy.utils.types module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="crantpy.viz.html">crantpy.viz package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="crantpy.viz.l2.html">crantpy.viz.l2 module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.viz.mesh.html">crantpy.viz.mesh module</a></li>
<li class="toctree-l4"><a class="reference internal" href="crantpy.viz.skeletonize.html">crantpy.viz.skeletonize module</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../datasets.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgements</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Social-Evolution-and-Behavior/crantpy" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Social-Evolution-and-Behavior/crantpy/edit/main/docs/api/crantpy.queries.connections.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Social-Evolution-and-Behavior/crantpy/issues/new?title=Issue%20on%20page%20%2Fapi/crantpy.queries.connections.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/api/crantpy.queries.connections.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>crantpy.queries.connections module</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function-overview">Function Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.attach_synapses"><code class="docutils literal notranslate"><span class="pre">attach_synapses()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.get_adjacency"><code class="docutils literal notranslate"><span class="pre">get_adjacency()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.get_connectivity"><code class="docutils literal notranslate"><span class="pre">get_connectivity()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.get_synapse_counts"><code class="docutils literal notranslate"><span class="pre">get_synapse_counts()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.get_synapses"><code class="docutils literal notranslate"><span class="pre">get_synapses()</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="module-crantpy.queries.connections">
<span id="crantpy-queries-connections-module"></span><h1>crantpy.queries.connections module<a class="headerlink" href="#module-crantpy.queries.connections" title="Link to this heading">#</a></h1>
<p>This module provides functions for querying synaptic connectivity in the CRANTb dataset.
Adapted from fafbseg-py (Philipp Schlegel) and the-BANC-fly-connectome (Jasper Phelps).</p>
<section id="function-overview">
<h2>Function Overview<a class="headerlink" href="#function-overview" title="Link to this heading">#</a></h2>
<p>This module contains four main functions for connectivity analysis, each serving
different use cases:</p>
<dl>
<dt>get_synapses()</dt><dd><p>Returns individual synaptic connections as a detailed DataFrame.</p>
<p>Use when you need:
- Raw synapse-level data with all available columns (coordinates, scores, etc.)
- Fine-grained analysis of individual synaptic connections
- Custom aggregation or filtering of synapses
- Access to synapse metadata (synapse_size, coordinates, quality scores)</p>
<p>Returns: DataFrame with one row per synapse</p>
</dd>
<dt>get_adjacency()</dt><dd><p>Returns a structured adjacency matrix showing connection strengths.</p>
<p>Use when you need:
- Matrix-based connectivity analysis
- Network analysis with standard matrix operations
- Symmetric connectivity matrices for undirected analysis
- Integration with graph theory libraries (NetworkX, igraph)
- Direct input for clustering or community detection algorithms</p>
<p>Returns: DataFrame adjacency matrix (neurons x neurons)</p>
</dd>
<dt>get_connectivity()</dt><dd><p>Returns aggregated connectivity as a simple edge list.</p>
<p>Use when you need:
- High-level connectivity overview between neurons
- Partner analysis (finding strongest connections)
- Simple edge lists for network visualization
- Quick connectivity summaries without detailed synapse info
- Input for graph visualization tools (Cytoscape, Gephi)</p>
<p>Returns: DataFrame with columns [pre, post, weight]</p>
</dd>
<dt>get_synapse_counts()</dt><dd><p>Returns summary statistics of synaptic connections per neuron.</p>
<p>Use when you need:
- Quick overview of neuron connectivity profiles
- Total incoming and outgoing connection counts
- Comparative analysis of neuron connectivity levels
- Filtering neurons by connectivity thresholds
- Summary statistics for large neuron populations</p>
<p>Returns: DataFrame with columns [pre, post] indexed by neuron ID</p>
</dd>
</dl>
</section>
<dl class="py function">
<dt class="sig sig-object py" id="crantpy.queries.connections.attach_synapses">
<span class="sig-prename descclassname"><span class="pre">crantpy.queries.connections.</span></span><span class="sig-name descname"><span class="pre">attach_synapses</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neurons</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pre</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">materialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'latest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_distance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/crantpy/queries/connections.html#attach_synapses"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#crantpy.queries.connections.attach_synapses" title="Link to this definition">#</a></dt>
<dd><p>Attach synapses as connectors to skeleton neurons.</p>
<p>This function fetches synapses for the given neuron(s) and maps them to the
closest node on each skeleton using a KD-tree. The synapses are attached as
a <cite>.connectors</cite> table with columns for connector_id, x, y, z, type (pre/post),
partner_id, and node_id.</p>
<p>Adapted from fafbseg-py (Philipp Schlegel) to work with CRANTb data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neurons</strong> (<em>navis.TreeNeuron</em><em> or </em><em>navis.NeuronList</em>) â€“ Skeleton neuron(s) to attach synapses to. Must be TreeNeuron objects
with node coordinates.</p></li>
<li><p><strong>pre</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to fetch and attach presynapses (outputs) for the given neurons.</p></li>
<li><p><strong>post</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to fetch and attach postsynapses (inputs) for the given neurons.</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 1</em>) â€“ Minimum number of synapses required between neuron pairs to be included.</p></li>
<li><p><strong>min_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>optional</em>) â€“ Minimum synapse size for filtering.</p></li>
<li><p><strong>materialization</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>default 'latest'</em>) â€“ Materialization version to use. Either â€˜latestâ€™ or â€˜liveâ€™.</p></li>
<li><p><strong>clean</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to perform cleanup of synapse data:
- Remove autapses (self-connections)
- Remove connections involving neuron ID 0 (background)
- Remove synapses that are too far from skeleton nodes (see max_distance)</p></li>
<li><p><strong>max_distance</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><em>float</em></a><em>, </em><em>default 10000.0</em>) â€“ Maximum distance (in nanometers) between a synapse and its nearest skeleton
node. Synapses further than this are removed if clean=True. The default of
10um helps filter out spurious synapse annotations far from the actual neuron.</p></li>
<li><p><strong>update_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to automatically update outdated root IDs to their latest versions
before querying. This ensures accurate results even after segmentation edits.
Uses efficient per-ID caching to minimize overhead for repeated queries.
Set to False only if youâ€™re certain all IDs are current (faster but risky).</p></li>
<li><p><strong>dataset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>optional</em>) â€“ Dataset to use for queries.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>The same neuron(s) with <cite>.connectors</cite> table attached. The connectors table
includes columns:
- connector_id: Unique ID for each synapse (sequential)
- x, y, z: Synapse coordinates in nanometers
- type: â€˜preâ€™ for presynapses, â€˜postâ€™ for postsynapses
- partner_id: Root ID of the partner neuron
- node_id: ID of the skeleton node closest to this synapse</p>
<p>Note: The input neurons are modified in place and also returned.</p>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>navis.TreeNeuron or navis.NeuronList</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.14)"><strong>TypeError</strong></a> â€“ If neurons is not a TreeNeuron or NeuronList of TreeNeurons.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> â€“ If both pre and post are False.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">crantpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get a skeleton neuron</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skeleton</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_l2_skeleton</span><span class="p">(</span><span class="mi">576460752664524086</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Attach synapses to it</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skeleton</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">attach_synapses</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># View the connectors table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">skeleton</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get only presynapses</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skeleton</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">attach_synapses</span><span class="p">(</span><span class="n">skeleton</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Filter distant synapses more aggressively</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skeleton</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">attach_synapses</span><span class="p">(</span><span class="n">skeleton</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Skip ID updates for faster queries (use only if IDs are known to be current)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skeleton</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">attach_synapses</span><span class="p">(</span><span class="n">skeleton</span><span class="p">,</span> <span class="n">update_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#crantpy.queries.connections.get_synapses" title="crantpy.queries.connections.get_synapses"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_synapses</span></code></a></dt><dd><p>Fetch synapse data without attaching to neurons.</p>
</dd>
</dl>
</div>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>This function modifies the input neurons in place by adding/updating the
.connectors attribute.</p></li>
<li><p>Synapses are mapped to skeleton nodes using scipyâ€™s KDTree for efficient
nearest neighbor search.</p></li>
<li><p>The connector_id is a sequential integer starting from 0, not the original
synapse ID from the database.</p></li>
<li><p>If a neuron already has a .connectors table, it will be overwritten.</p></li>
<li><p>Synapse coordinates are automatically converted from pixels to nanometers
to match skeleton coordinate system (using SCALE_X=8, SCALE_Y=8, SCALE_Z=42).</p></li>
<li><p>When update_ids=True (default), IDs are automatically updated with efficient caching</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="crantpy.queries.connections.get_adjacency">
<span class="sig-prename descclassname"><span class="pre">crantpy.queries.connections.</span></span><span class="sig-name descname"><span class="pre">get_adjacency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pre_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">materialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'latest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symmetric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/crantpy/queries/connections.html#get_adjacency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#crantpy.queries.connections.get_adjacency" title="Link to this definition">#</a></dt>
<dd><p>Construct an adjacency matrix from synaptic connections between neurons.</p>
<p>This function queries the synapses table to get connections between specified
pre- and post-synaptic neurons, then constructs an adjacency matrix showing
the number of synapses between each pair.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pre_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><em>list</em></a><em>, </em><em>NeuronCriteria</em><em>, </em><em>optional</em>) â€“ Pre-synaptic neuron root IDs or criteria. If None, all pre-synaptic
neurons in the dataset will be included.</p></li>
<li><p><strong>post_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><em>list</em></a><em>, </em><em>NeuronCriteria</em><em>, </em><em>optional</em>) â€“ Post-synaptic neuron root IDs or criteria. If None, all post-synaptic
neurons in the dataset will be included.</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 1</em>) â€“ Minimum number of synapses required between a pair to be included
in the adjacency matrix.</p></li>
<li><p><strong>min_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>optional</em>) â€“ Minimum size for filtering synapses before constructing adjacency matrix.</p></li>
<li><p><strong>materialization</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>default 'latest'</em>) â€“ Materialization version to use. â€˜latestâ€™ (default) or â€˜liveâ€™ for live table.</p></li>
<li><p><strong>symmetric</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default False</em>) â€“ If True, return a symmetric adjacency matrix with the same set of IDs on
both rows and columns. The neuron set includes all neurons that appear
in the filtered synapses data (union of all pre- and post-synaptic neurons).
This provides a complete view of connectivity among all neurons involved
in the queried connections.
If False (default), rows represent pre-synaptic neurons and columns
represent post-synaptic neurons from the actual synapses data.</p></li>
<li><p><strong>clean</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to perform cleanup of the underlying synapse data:
- Remove autapses (self-connections)
- Remove connections involving neuron ID 0 (background)
This parameter is passed to get_synapses().</p></li>
<li><p><strong>update_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to automatically update outdated root IDs to their latest versions
before querying. This ensures accurate results even after segmentation edits.
Uses efficient per-ID caching to minimize overhead for repeated queries.
Set to False only if youâ€™re certain all IDs are current (faster but risky).</p></li>
<li><p><strong>dataset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>optional</em>) â€“ Dataset to use for the query.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An adjacency matrix where each entry [i, j] represents the number of
synapses from neuron i (pre-synaptic) to neuron j (post-synaptic).
Rows are pre-synaptic neurons, columns are post-synaptic neurons.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">crantpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get adjacency between specific neurons</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adj</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_adjacency</span><span class="p">(</span><span class="n">pre_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752641833774</span><span class="p">],</span> <span class="n">post_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752777916050</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get adjacency with minimum threshold</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adj</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_adjacency</span><span class="p">(</span><span class="n">pre_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752641833774</span><span class="p">],</span> <span class="n">post_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752777916050</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get symmetric adjacency matrix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adj</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_adjacency</span><span class="p">(</span><span class="n">pre_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752641833774</span><span class="p">],</span> <span class="n">post_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752777916050</span><span class="p">],</span> <span class="n">symmetric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get adjacency matrix with autapses included</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adj</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_adjacency</span><span class="p">(</span><span class="n">pre_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752641833774</span><span class="p">],</span> <span class="n">post_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752777916050</span><span class="p">],</span> <span class="n">clean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Skip ID updates for faster queries (use only if IDs are known to be current)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adj</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_adjacency</span><span class="p">(</span><span class="n">pre_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752641833774</span><span class="p">],</span> <span class="n">post_ids</span><span class="o">=</span><span class="p">[</span><span class="mi">576460752777916050</span><span class="p">],</span> <span class="n">update_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>This function uses get_synapses() internally to retrieve synaptic connections</p></li>
<li><p>If both pre_ids and post_ids are None, this will query all synapses in the dataset</p></li>
<li><p>The threshold parameter filters connection pairs, not individual synapses</p></li>
<li><p>When symmetric=True, the resulting matrix includes all neurons that appear in the
filtered synapses data, ensuring complete connectivity visualization</p></li>
<li><p>When symmetric=False, the matrix may be rectangular with different neuron sets
for rows (pre-synaptic) and columns (post-synaptic)</p></li>
<li><p>When clean=True (default), autapses and background connections are removed</p></li>
<li><p>When update_ids=True (default), IDs are automatically updated with efficient caching</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="crantpy.queries.connections.get_connectivity">
<span class="sig-prename descclassname"><span class="pre">crantpy.queries.connections.</span></span><span class="sig-name descname"><span class="pre">get_connectivity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neuron_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upstream</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">downstream</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">materialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'latest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/crantpy/queries/connections.html#get_connectivity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#crantpy.queries.connections.get_connectivity" title="Link to this definition">#</a></dt>
<dd><p>Fetch connectivity information for given neuron(s) in CRANTb.</p>
<p>This function retrieves synaptic connections for the specified neurons,
returning a table of connections with pre-synaptic neurons, post-synaptic
neurons, and synapse counts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neuron_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><em>list</em></a><em>, </em><em>NeuronCriteria</em>) â€“ Neuron root ID(s) to query connectivity for. Can be a single ID,
list of IDs, or NeuronCriteria object.</p></li>
<li><p><strong>upstream</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to fetch upstream (incoming) connectivity to the query neurons.</p></li>
<li><p><strong>downstream</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to fetch downstream (outgoing) connectivity from the query neurons.</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 1</em>) â€“ Minimum number of synapses required between a pair to be included
in the results.</p></li>
<li><p><strong>min_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>optional</em>) â€“ Minimum size for filtering synapses before aggregating connections.</p></li>
<li><p><strong>materialization</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>default 'latest'</em>) â€“ Materialization version to use. â€˜latestâ€™ (default) or â€˜liveâ€™ for live table.</p></li>
<li><p><strong>clean</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to perform cleanup of the underlying synapse data:
- Remove autapses (self-connections)
- Remove connections involving neuron ID 0 (background)
This parameter is passed to get_synapses().</p></li>
<li><p><strong>update_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to automatically update outdated root IDs to their latest versions
before querying. This ensures accurate results even after segmentation edits.
Uses efficient per-ID caching to minimize overhead for repeated queries.
Set to False only if youâ€™re certain all IDs are current (faster but risky).</p></li>
<li><p><strong>dataset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>optional</em>) â€“ Dataset to use for the query.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Connectivity table with columns:
- â€˜preâ€™: pre-synaptic neuron ID
- â€˜postâ€™: post-synaptic neuron ID
- â€˜weightâ€™: number of synapses between the pair</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> â€“ If both upstream and downstream are False.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">crantpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get all connections for a neuron</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="mi">576460752641833774</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get only downstream connections with threshold</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="mi">576460752641833774</span><span class="p">,</span> <span class="n">upstream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get connectivity for multiple neurons</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">([</span><span class="mi">576460752641833774</span><span class="p">,</span> <span class="mi">576460752777916050</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Skip ID updates for faster queries (use only if IDs are known to be current)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_connectivity</span><span class="p">(</span><span class="mi">576460752641833774</span><span class="p">,</span> <span class="n">update_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>This function uses get_synapses() internally to retrieve synaptic connections</p></li>
<li><p>Results are aggregated by pre-post neuron pairs and sorted by synapse count</p></li>
<li><p>When clean=True, autapses and background connections are removed</p></li>
<li><p>When update_ids=True (default), IDs are automatically updated with efficient caching</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="crantpy.queries.connections.get_synapse_counts">
<span class="sig-prename descclassname"><span class="pre">crantpy.queries.connections.</span></span><span class="sig-name descname"><span class="pre">get_synapse_counts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neuron_ids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">materialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'latest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/crantpy/queries/connections.html#get_synapse_counts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#crantpy.queries.connections.get_synapse_counts" title="Link to this definition">#</a></dt>
<dd><p>Get synapse counts (pre and post) for given neuron IDs in CRANTb.</p>
<p>This function returns the total number of presynaptic and postsynaptic
connections for each specified neuron, aggregated across all their partners.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neuron_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><em>list</em></a><em>, </em><em>NeuronCriteria</em>) â€“ Neuron root ID(s) to get synapse counts for. Can be a single ID,
list of IDs, or NeuronCriteria object.</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 1</em>) â€“ Minimum number of synapses required between a pair to be counted
towards the total. Pairs with fewer synapses are excluded.</p></li>
<li><p><strong>min_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>optional</em>) â€“ Minimum size for filtering individual synapses before counting.</p></li>
<li><p><strong>materialization</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>default 'latest'</em>) â€“ Materialization version to use. â€˜latestâ€™ (default) or â€˜liveâ€™ for live table.</p></li>
<li><p><strong>clean</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to perform cleanup of the underlying synapse data:
- Remove autapses (self-connections)
- Remove connections involving neuron ID 0 (background)
This parameter is passed to get_connectivity().</p></li>
<li><p><strong>update_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to automatically update outdated root IDs to their latest versions
before querying. This ensures accurate results even after segmentation edits.
Uses efficient per-ID caching to minimize overhead for repeated queries.
Set to False only if youâ€™re certain all IDs are current (faster but risky).</p></li>
<li><p><strong>dataset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>optional</em>) â€“ Dataset to use for the query.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataFrame with columns:
- index: neuron IDs
- â€˜preâ€™: number of presynaptic connections (outgoing)
- â€˜postâ€™: number of postsynaptic connections (incoming)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">crantpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get synapse counts for a single neuron</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">counts</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_synapse_counts</span><span class="p">(</span><span class="mi">576460752641833774</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get counts for multiple neurons with threshold</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">counts</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_synapse_counts</span><span class="p">([</span><span class="mi">576460752641833774</span><span class="p">,</span> <span class="mi">576460752777916050</span><span class="p">],</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Skip ID updates for faster queries (use only if IDs are known to be current)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">counts</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_synapse_counts</span><span class="p">(</span><span class="mi">576460752641833774</span><span class="p">,</span> <span class="n">update_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>This function uses get_connectivity() internally to get connection data</p></li>
<li><p>Counts represent the number of distinct synaptic partners, not individual synapses</p></li>
<li><p>The threshold is applied at the connection level (pairs of neurons)</p></li>
<li><p>When update_ids=True (default), IDs are automatically updated with efficient caching</p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="crantpy.queries.connections.get_synapses">
<span class="sig-prename descclassname"><span class="pre">crantpy.queries.connections.</span></span><span class="sig-name descname"><span class="pre">get_synapses</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pre_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">post_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">materialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'latest'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_pixels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">update_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/crantpy/queries/connections.html#get_synapses"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#crantpy.queries.connections.get_synapses" title="Link to this definition">#</a></dt>
<dd><p>Fetch synapses for a given set of pre- and/or post-synaptic neuron IDs in CRANTb.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pre_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><em>list</em></a><em> of </em><em>int/str</em><em>, </em><em>NeuronCriteria</em><em>, </em><em>optional</em>) â€“ Pre-synaptic neuron root ID(s) to include. Can be a single ID, list of IDs,
or NeuronCriteria object.</p></li>
<li><p><strong>post_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><em>list</em></a><em> of </em><em>int/str</em><em>, </em><em>NeuronCriteria</em><em>, </em><em>optional</em>) â€“ Post-synaptic neuron root ID(s) to include. Can be a single ID, list of IDs,
or NeuronCriteria object.</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>default 1</em>) â€“ Minimum number of synapses required for a partner to be retained.
Currently we donâ€™t know what a good threshold is.</p></li>
<li><p><strong>min_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><em>int</em></a><em>, </em><em>optional</em>) â€“ Minimum size for filtering synapses. Currently we donâ€™t know what a good size is.</p></li>
<li><p><strong>materialization</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>default 'latest'</em>) â€“ Materialization version to use. â€˜latestâ€™ (default) or â€˜liveâ€™ for live table.</p></li>
<li><p><strong>return_pixels</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to convert coordinate columns from nanometers to pixels.
If True (default), coordinates in ctr_pt_position, pre_pt_position, and
post_pt_position are converted using dataset scale factors.
If False, coordinates remain in nanometer units.</p></li>
<li><p><strong>clean</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to perform cleanup of the synapse data:
- Remove autapses (self-connections)
- Remove connections involving neuron ID 0 (background)</p></li>
<li><p><strong>update_ids</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><em>bool</em></a><em>, </em><em>default True</em>) â€“ Whether to automatically update outdated root IDs to their latest versions
before querying. This ensures accurate results even after segmentation edits.
Uses efficient per-ID caching to minimize overhead for repeated queries.
Set to False only if youâ€™re certain all IDs are current (faster but risky).</p></li>
<li><p><strong>dataset</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><em>str</em></a><em>, </em><em>optional</em>) â€“ Dataset to use for the query.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataFrame of synaptic connections.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> â€“ If neither pre_ids nor post_ids are provided.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>When update_ids=True (default), outdated root IDs are automatically updated
using supervoxel IDs from annotations when available for fast, reliable updates</p></li>
<li><p>ID updates are cached per-ID, so repeated queries with overlapping IDs are efficient</p></li>
<li><p>Updated IDs are used for the query, but the original IDs are not modified in place</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><code class="xref py py-obj docutils literal notranslate"><span class="pre">update_ids</span></code></dt><dd><p>Manually update root IDs to their latest versions</p>
</dd>
</dl>
</div>
</dd></dl>

</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./api"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="crantpy.queries.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">crantpy.queries package</p>
      </div>
    </a>
    <a class="right-next"
       href="crantpy.queries.neurons.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">crantpy.queries.neurons module</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function-overview">Function Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.attach_synapses"><code class="docutils literal notranslate"><span class="pre">attach_synapses()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.get_adjacency"><code class="docutils literal notranslate"><span class="pre">get_adjacency()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.get_connectivity"><code class="docutils literal notranslate"><span class="pre">get_connectivity()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.get_synapse_counts"><code class="docutils literal notranslate"><span class="pre">get_synapse_counts()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crantpy.queries.connections.get_synapses"><code class="docutils literal notranslate"><span class="pre">get_synapses()</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By CRANTb Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>